const { Composer, Telegraf } = require('telegraf')
const composer = new Composer()
const kb = require('../keyboars.json')
const utils = require('../utils')
const token = process.env.TOKEN_BOT
const bot = new Telegraf(token)

composer.hears("üöÄ –í—ã–≤–æ–¥ –ø—Ä–µ–¥–º–µ—Ç–æ –≤", async (ctx) => {
    try {
        const user = await utils.getUserData(ctx.from.id)

        if (!user.items || user.items === 0) {
            await ctx.sendMessage('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞.', kb.withdraw_back);
            return;
        }

        let txt = '‚ö†Ô∏è–í–Ω–∏–º–∞–Ω–∏–µ:\n'
        txt += '–í—ã–≤–æ–¥ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –µ—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ –ª—É–Ω/–ø—Ä–æ–ø—É—Å–∫–æ–≤ —É –≤–ª–∞–¥–µ–ª—å—Ü–∞ –±–æ—Ç–∞.\n\n'
        txt += '–û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–ø–∞—Å—ã —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é.\n'
        txt += '–ü—Ä–µ–¥–º–µ—Ç—ã –≤—ã–≤–æ–¥—è—Ç—Å—è —Å—Ä–∞–∑—É –≤—Å–µ, –∫—Ä–æ–º–µ 60 üíé / üí† . –ò—Ö –≤—ã–≤–µ—Å—Ç–∏ –Ω–µ–ª—å–∑—è.\n'
        txt += '–ù–∞–∂–∏–º–∞—è –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–≤–æ–¥, –≤—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ —Å –ø–æ–ª—É—á–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.\n\n'
        txt += '‚ö†Ô∏è–í–ù–ò–ú–ê–ù–ò–ï:\n'
        txt += '–í—ã–≤–æ–¥ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º –∑–∞—á–∏—Å–ª–µ–Ω–∏—è –ª—É–Ω—ã/–ø—Ä–æ–ø—É—Å–∫–∞ –ø–æ UID. –ú–´ –ù–ï –ü–†–û–°–ò–ú –í–ê–®–ò–• –õ–û–ì–ò–ù–û–í –ò –ü–ê–†–û–õ–ï–ô, –ë–£–î–¨–¢–ï –í–ù–ò–ú–ê–¢–ï–õ–¨–ù–´!\n'

        let txtNow = '‚ö†Ô∏è–í–ù–ò–ú–ê–ù–ò–ï!\n'
        txtNow += '–í—ã–≤–æ–¥ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω! –ü–æ–ª–Ω–æ—Å—Ç—å—é –º–µ–Ω—è–µ–º —Å–∏—Å—Ç–µ–º—É –≤—ã–¥–∞—á–∏.\n'
        txtNow += '–¢–µ–ø–µ—Ä—å –≤—ã —Å–º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å-–∫–æ–¥ –¥–ª—è —Å–∞–π—Ç–∞ GENSHINDROP, –±–æ—Ç –ø—Ä–∏—à–ª–µ—Ç –µ–≥–æ —Å–∞–º.\n'
        txtNow += '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ 20-–µ —á–∏—Å–ª–∞ —è–Ω–≤–∞—Ä—è.\n' 
        txtNow += '–ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –≤ –∫–∞–Ω–∞–ª–µ –∫—É–±–∏–∫–∞: @cube_updates.\n\n'
        txtNow += '–í–ê–®–ò –õ–£–ù–´ –ò –ü–†–û–ü–£–°–ö–ê –ù–ò–ö–£–î–ê –ù–ï –ü–†–û–ü–ê–î–£–¢, –ù–ï –ü–ï–†–ï–ñ–ò–í–ê–ô–¢–ï!'

        await ctx.sendMessage(txtNow, kb.not_confirm_withdraw);

    } catch (e) {
        console.log(e)
    }
})

composer.action("confirm_withdrawal", async (ctx) => {
    try {
        const user = await utils.getUserData(ctx.from.id)
      
        await utils.updateUserData(ctx.from.id, 'items', 0);
      
        const withdrawalRequest = `–ó–∞–ø—Ä–æ—Å –≤—ã–≤–æ–¥–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${user.nickname}: ${user.items} –ª—É–Ω (—É—Ç–æ—á–Ω–∏—Ç–µ –≤ –∫–∞–∫—É—é –∏–º–µ–Ω–Ω–æ –∏–≥—Ä—É –æ–Ω —Ö–æ—á–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –≤—ã–≤–æ–¥)`;
      
        await bot.telegram.sendMessage(process.env.WITHDRAWAL_ACCOUNT, withdrawalRequest)
        let txt = '–ó–∞–ø—Ä–æ—Å –Ω–∞ –≤—ã–≤–æ–¥ –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞–ø–∏—à–∏—Ç–µ @kitikzinger_x , —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –æ —Ç–æ–º, –∫–æ–≥–¥–∞ —Å–º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å —Å–≤–æ—é –Ω–∞–≥—Ä–∞–¥—É.\n'
        txt += '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –ø–∏—à–∏—Ç–µ –Ω–æ—á—å—é, —è –Ω–µ –æ—Ç–≤–µ—á—É, —è —Å–ø–∞—Ç—å –±—É–¥—Éüò¥\n\n'
        txt += '–í—ã–≤–æ–¥—ã –º–æ–≥—É—Ç –∑–∞–Ω—è—Ç—å –¥–æ 14-—Ç–∏ –¥–Ω–µ–π, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è –ª—É–Ω/–ø—Ä–æ–ø—É—Å–∫–æ–≤!\n'

        await ctx.editMessageText(txt, kb.withdraw_back);
        
    } catch (e) {
        console.log(e)
    }
})

module.exports = composer